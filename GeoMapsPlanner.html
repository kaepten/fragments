<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>GeoMaps Planner</title>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>

    <script type="text/javascript" src="js/Base.js"></script>
    <script type="text/javascript" src="js/Coordinate.js"></script>
    <script type="text/javascript" src="js/Core.js"></script>
    <script type="text/javascript" src="js/Geo.js"></script>
    <script type="text/javascript" src="js/wgs84_ch1903.js"></script>
    <script type="text/javascript" src="js/latlon.js"></script>
    <script type="text/javascript" src="js/settings.js"></script>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:600, 400,300' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,200,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="ol3/ol.css" type="text/css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">

    <link rel="stylesheet" href="css/glyphicon.css">
    <link rel="stylesheet" href="css/fragment.css">

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>

    <style>
        .tbody {
            /*font-family: 'Open Sans', sans-serif;*/
            font-family: 'Yanone Kaffeesatz', sans-serif;
            font-weight: 400;
            font-size: 1em;
        }

        .rotate-north {
            position: absolute;
            top: 165px;
            left: 8px;
            background: rgba(255,255,255,0.8);
            border-radius: 4px;
            padding: 2px;
        }
        .ol-touch .rotate-north {
            top: 80px;
        }
        .rotate-north a {
            display: block;
            color: black;
            font-size: 16px;
            margin: 1px;
            text-decoration: none;
            text-align: center;
            border-radius: 2px;
            height: 22px;
            width: 150px;
            background: rgba(0,60,136,0.4);
        }
        .ol-touch .rotate-north a {
            font-size: 20px;
            height: 30px;
            width: 30px;
            line-height: 28px;
        }
        .rotate-north a:hover {
            background: rgba(0,60,136,0.7);
        }
    </style>

</head>
<body>

    <div id="sidebarcontrol" class="sidebarcontrol reset"><span id="sidebarcontrolicon"><i class="glyphicon glyphicons-chevron-right"></i></span></div>
    <div id="sidebar">
        <div id="GeoMapsCalculator" class="gM calculator">
            <div class="header">
                <div class="clearfix">
                    <div class="left">
                        <input id="newCoordinate" type="text" value="">
                    </div>
                    <div class="left">
                        <a class="cmd newCoord"><span class="fa fa-compass"></span></a>
                    </div>
                    <div class="right">
                        <a class="cmd allShowHide"><span class="glyphicon glyphicon-eye-close"></span></a>
                        <a class="cmd allUpDown"><span class="glyphicon glyphicon-chevron-up"></span></a>
                        <a class="cmd allDelete"><span class="glyphicon glyphicon-remove-circle"></span></a>
                    </div>
                </div>
                <div>
                    <input type="radio" name="CoordFormat" value="LV03">SwissGrid
                    <input type="radio" name="CoordFormat" value="Dms">Dms
                    <input type="radio" name="CoordFormat" value="Ddd">Ddd
                    <input type="radio" name="CoordFormat" value="Dmm">Dmm
                </div>
                <div>
                    <a class="cmd delSettings">Alle Settings löschen</a>
                </div>
            </div>
            <ul class="cordBoxList"></ul>
        </div>
    </div>

    <div id="map" class="map"></div>
    <script src="http://api3.geo.admin.ch/loader.js?lang=en" type="text/javascript"></script>

    <script src="js/GeoMapsPlanner.js" type="text/javascript"></script>

    <script>

        $(document).ready(function () {
            DrawWayPoints();
        });

        var wayPoints=[];

        function DrawWayPoints(){

            var styleArr = [];

            var iconStyle1 = new ol.style.Style({
                image: new ol.style.Icon(/** @type {olx.style.IconOptions} */ ({
                    anchor: [0.5, 40],
                    anchorXUnits: 'fraction',
                    anchorYUnits: 'pixels',
                    src: '//map.geo.admin.ch/1403704943/img/marker.png'
                }))
            });

            var iconStyle2 = new ol.style.Style({
                image: new ol.style.Icon(/** @type {olx.style.IconOptions} */ ({
                    anchor: [0.5, 40],
                    anchorXUnits: 'fraction',
                    anchorYUnits: 'pixels',
                    src: '//www.c-dev.ch/projects/flag-ch.png'
                }))
            });

            var iconStyle = new ol.style.Style({
                image: new ol.style.Icon(/** @type {olx.style.IconOptions} */ ({
                    anchor: [0.5, 40],
                    anchorXUnits: 'fraction',
                    anchorYUnits: 'pixels',
                    src: '//www.c-dev.ch/projects/flag-fm.png'
                }))
            });

            styleArr.push(iconStyle1);
            styleArr.push(iconStyle2);
            styleArr.push(iconStyle);

            var settings = geoMapsSettings;

            var coordsCount = settings.siteSetting.coordSettings.length;
            for (var currentCoordIndex = 0; currentCoordIndex < coordsCount; currentCoordIndex++) {
                var currentCoord = settings.siteSetting.coordSettings[currentCoordIndex];

                var point = new ol.Feature({
                    geometry: new ol.geom.Point([currentCoord.coordinate.Lv03.Y.Meter, currentCoord.coordinate.Lv03.X.Meter]),
                    name: currentCoord.description,
                    gmCoordinate: currentCoord
                });
                point.setStyle(styleArr[0]);
                wayPoints.push(point);
            }

            var vectorSource = new ol.source.Vector({
                features: wayPoints
            });
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource
            });
            map.addLayer(vectorLayer);
        }

        function DrawSingleWayPoint(newCoord)
        {
            var wayPoints=[];
            var point = new ol.Feature({
                geometry: new ol.geom.Point([newCoord.coordinate.Lv03.Y.Meter, newCoord.coordinate.Lv03.X.Meter]),
                name: newCoord.description,
                gmCoordinate: newCoord
            });
            wayPoints.push(point);

            var iconStyle = new ol.style.Style({
                image: new ol.style.Icon(/** @type {olx.style.IconOptions} */ ({
                    // anchor: [0.5, 46],
                    anchor: [0.5, 40],
                    anchorXUnits: 'fraction',
                    anchorYUnits: 'pixels',
                    src: '//map.geo.admin.ch/1403704943/img/marker.png'
                }))
            });

            var vectorSource = new ol.source.Vector({
                features: wayPoints
            });
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: iconStyle
            });
            map.addLayer(vectorLayer);
        }


        function DeleteSingleWayPoint(delCoordId) {
            for(var index=0; index<wayPoints.length; index++) {
                var cordId = wayPoints[index].j.gmCoordinate.id;
                if(cordId == delCoordId) {
                    wayPoints.slice(wayPoints[index]);
                    break;
                }
            }
        }





        // Layer /Waypoint mit Beschriftung
        // http://openlayers.org/en/v3.1.1/examples/vector-labels.html

        // Zu Waypoint bewegen
        //      http://openlayers.org/en/v3.1.1/examples/animation.html

        // Bing Map example - Satellitenansicht
        //      http://openlayers.org/en/v3.1.1/examples/bing-maps.html

        // OpenStreetMap
        //      http://openlayers.org/en/v3.1.1/examples/localized-openstreetmap.html

        // GSON Daten laden mit Zusatzinfo - diese Info bei drag-viereck anzeigen!
        //      http://openlayers.org/en/v3.1.1/examples/box-selection.html

        // Schönes Beispiel wo die Kartencontrols mit Bootstrap ToolTips versehen worden sind
        //      http://openlayers.org/en/v3.1.1/examples/button-title.html

        // Zoom und Center Beipsiel
        //      http://openlayers.org/en/v3.1.1/examples/center.html

        // Custom Control Beispiel (Rotation)
        //      http://openlayers.org/en/v3.1.1/examples/custom-controls.html

        // Zoom Slider Custom Control
        // http://openlayers.org/en/v3.1.1/examples/zoomslider.html

        // Drag Marker
        //      http://openlayers.org/en/v3.1.1/examples/drag-features.html

        // Waypoint / Feature hinzufügen und Draggen
        //      http://openlayers.org/en/v3.1.1/examples/draw-and-modify-features.html


        // Waypoint / Feature & Linie zeichnen / hinzufügen
        //      http://openlayers.org/en/v3.1.1/examples/draw-features.html

        // Komplexes Beispiel mit importierten Daten, Mouspointer zeigt Info von Track
        //      http://openlayers.org/en/v3.1.1/examples/igc.html

        // Messen von Strecken (zeichnen und Länge ausgabe
        //      http://openlayers.org/en/v3.1.1/examples/measure.html

        // Mausposition auslesen und anzeigen
        //      http://openlayers.org/en/v3.1.1/examples/mouse-position.html

        // Position Popup (Bootstrap)
        //      http://openlayers.org/en/v3.1.1/examples/overlay.html

        // Näher Untersuchen - Schweizerkarte mit Layers!
        // http://openlayers.org/en/v3.1.1/examples/wms-custom-proj.html


        // Mouseover zeigt Feature Information
        //      http://openlayers.org/en/v3.1.1/examples/vector-layer.html









        window.app = {};
        var app = window.app;


        /**
         * @constructor
         * @extends {ol.control.Control}
         * @param {Object=} opt_options Control options.
         */
        app.RotateNorthControl = function(opt_options) {

            var options = opt_options || {};

            var anchor = document.createElement('a');
            anchor.href = '#rotate-north';
            anchor.innerHTML = '<span id="geoMapKoords"></span>';

            var this_ = this;
            var handleRotateNorth = function(e) {
                // prevent #rotate-north anchor from getting appended to the url
                e.preventDefault();
                this_.getMap().getView().setRotation(this_.getMap().getView().getRotation() + 90);
            };

            anchor.addEventListener('click', handleRotateNorth, false);
            anchor.addEventListener('touchstart', handleRotateNorth, false);

            var element = document.createElement('div');
            element.className = 'rotate-north ol-unselectable';
            element.appendChild(anchor);

            ol.control.Control.call(this, {
                element: element,
                target: options.target
            });
        };
        ol.inherits(app.RotateNorthControl, ol.control.Control);












        var layer = ga.layer.create('ch.swisstopo.pixelkarte-farbe');
        var map = new ga.Map({
            controls: ol.control.defaults({
                attributionOptions: /** @type {olx.control.AttributionOptions} */ ({
                    collapsible: false
                })
            }).extend([
                new app.RotateNorthControl()
            ]),
            target: 'map',
            layers: [layer],
            view: new ol.View({
                resolution: 3,
                center: [679420,235646]
            })
        });

        var mousePositionControl = new ol.control.MousePosition({
            coordinateFormat: ol.coordinate.createStringXY(0),
            projection: 'EPSG:21781',
            className: 'custom-mouse-position',
            target: document.getElementById('geoMapKoords'),
            undefinedHTML: '&nbsp;'
        });

        map.addControl(mousePositionControl);




        var displayFeatureInfo = function(pixel) {

            var feature = map.forEachFeatureAtPixel(pixel, function(feature, layer) {
                return feature;
            });

            if (feature) {
                var x = 1;
            }

            // var info = document.getElementById('info');
            // if (feature) { info.innerHTML = feature.getId() + ': ' + feature.get('name'); } else { info.innerHTML = '&nbsp;';}
        };

        $(map.getViewport()).on('mousemove', function(evt) {
            var pixel = map.getEventPixel(evt.originalEvent);
            // displayFeatureInfo(pixel);
        });

        map.on('click', function(evt) {

            var coordinate = evt.coordinate;
            $("#newCoordinate").val(coordinate[0] + " " + coordinate[1]);

            displayFeatureInfo(evt.pixel);
        });





    </script>

    <div stlye="z-index:1;">
        <p>Bank: 678975 236021 Parkplatz: 678900 236121</p>
        <p>Bank: N 47° 16.0483 E 008° 29.3288 Parkplatz: N 47° 16.2483 E 008° 29.5233</p>
    </div>

</body>
</html>