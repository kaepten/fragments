<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>GeoMaps Planner</title>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>

    <script type="text/javascript" src="js/Base.js"></script>
    <script type="text/javascript" src="js/Coordinate.js"></script>
    <script type="text/javascript" src="js/Core.js"></script>
    <script type="text/javascript" src="js/Geo.js"></script>
    <script type="text/javascript" src="js/wgs84_ch1903.js"></script>
    <script type="text/javascript" src="js/latlon.js"></script>
    <script type="text/javascript" src="js/settings.js"></script>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:600, 400,300' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,200,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="ol3/ol.css" type="text/css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">

    <link rel="stylesheet" href="css/glyphicon.css">
    <link rel="stylesheet" href="css/fragment.css">

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>

    <style>
        .tbody {
            /*font-family: 'Open Sans', sans-serif;*/
            font-family: 'Yanone Kaffeesatz', sans-serif;
            font-weight: 400;
            font-size: 1em;
        }

        .rotate-north {
            position: absolute;
            top: 165px;
            left: 8px;
            background: rgba(255,255,255,0.8);
            border-radius: 4px;
            padding: 2px;
        }
        .ol-touch .rotate-north {
            top: 80px;
        }
        .rotate-north a {
            display: block;
            color: black;
            font-size: 16px;
            margin: 1px;
            text-decoration: none;
            text-align: center;
            border-radius: 2px;
            height: 22px;
            width: 150px;
            background: rgba(0,60,136,0.4);
        }
        .ol-touch .rotate-north a {
            font-size: 20px;
            height: 30px;
            width: 30px;
            line-height: 28px;
        }
        .rotate-north a:hover {
            background: rgba(0,60,136,0.7);
        }
    </style>

</head>
<body>

    <div id="sidebarcontrol" class="sidebarcontrol reset"><span id="sidebarcontrolicon"><i class="glyphicon glyphicons-chevron-right"></i></span></div>
    <div id="sidebar">
        <div id="GeoMapsCalculator" class="gM calculator">
            <div class="header">
                <div class="clearfix">
                    <div class="left">
                        <input id="newCoordinate" type="text" value="">
                    </div>
                    <div class="left">
                        <a class="cmd newCoord"><span class="fa fa-compass"></span></a>
                    </div>
                    <div class="right">
                        <a class="cmd allShowHide"><span class="glyphicon glyphicon-eye-close"></span></a>
                        <a class="cmd allUpDown"><span class="glyphicon glyphicon-chevron-up"></span></a>
                        <a class="cmd allDelete"><span class="glyphicon glyphicon-remove-circle"></span></a>
                    </div>
                </div>
                <div>
                    <input type="radio" name="CoordFormat" value="LV03">SwissGrid
                    <input type="radio" name="CoordFormat" value="Dms">Dms
                    <input type="radio" name="CoordFormat" value="Ddd">Ddd
                    <input type="radio" name="CoordFormat" value="Dmm">Dmm
                </div>
                <div>
                    <a class="cmd delSettings">Alle Settings löschen</a>
                </div>
            </div>
            <ul class="cordBoxList"></ul>
        </div>
    </div>

    <div id="map" class="map"></div>
    <script src="http://api3.geo.admin.ch/loader.js?lang=en" type="text/javascript"></script>

    <script src="js/GeoMapsPlanner.js" type="text/javascript"></script>

    <script>

        $(document).ready(function () {
            DrawWayPoints();
        });

        var wayPoints=[];

        function DrawWayPoints(){
            var settings = geoMapsSettings;
            var coordsCount = settings.siteSetting.coordSettings.length;
            for (var currentCoordIndex = 0; currentCoordIndex < coordsCount; currentCoordIndex++) {
                var currentCoord = settings.siteSetting.coordSettings[currentCoordIndex];

                if(!ArrayContains(wayPoints, currentCoord)) {
                    var point = new ol.Feature({
                        geometry: new ol.geom.Point([currentCoord.coordinate.Lv03.Y.Meter, currentCoord.coordinate.Lv03.X.Meter]),
                        name: 'Null Island',
                        population: 4000,
                        rainfall: 500,
                        coordinate: currentCoord
                    });
                    wayPoints.push(point);
                }
            }

            var iconStyle = new ol.style.Style({
                image: new ol.style.Icon(/** @type {olx.style.IconOptions} */ ({
                    anchor: [0.5, 46],
                    anchorXUnits: 'fraction',
                    anchorYUnits: 'pixels',
                    src: '//map.geo.admin.ch/1403704943/img/marker.png'
                }))
            });

            var vectorSource = new ol.source.Vector({
                features: wayPoints
            });
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: iconStyle
            });



            map.addLayer(vectorLayer);
        }

        function ArrayContains(wayPointsList, coord) {
            for(var index=0; index<wayPointsList.length; index++) {
                if(coord.id == wayPointsList[index].j.coordinate.id) {
                    return true;
                }
            }
            return false;
        }


        /*
        // Layer /Waypoint mit Beschriftung
        // http://openlayers.org/en/v3.1.1/examples/vector-labels.html

        // Zu Waypoint bewegen
        //      http://openlayers.org/en/v3.1.1/examples/animation.html

        // Bing Map example - Satellitenansicht
        //      http://openlayers.org/en/v3.1.1/examples/bing-maps.html

        // OpenStreetMap
        //      http://openlayers.org/en/v3.1.1/examples/localized-openstreetmap.html

        // GSON Daten laden mit Zusatzinfo - diese Info bei drag-viereck anzeigen!
        //      http://openlayers.org/en/v3.1.1/examples/box-selection.html

        // Schönes Beispiel wo die Kartencontrols mit Bootstrap ToolTips versehen worden sind
        //      http://openlayers.org/en/v3.1.1/examples/button-title.html

        // Zoom und Center Beipsiel
        //      http://openlayers.org/en/v3.1.1/examples/center.html

        // Custom Control Beispiel (Rotation)
        //      http://openlayers.org/en/v3.1.1/examples/custom-controls.html

        // Zoom Slider Custom Control
        // http://openlayers.org/en/v3.1.1/examples/zoomslider.html

        // Drag Marker
        //      http://openlayers.org/en/v3.1.1/examples/drag-features.html

        // Waypoint / Feature hinzufügen und Draggen
        //      http://openlayers.org/en/v3.1.1/examples/draw-and-modify-features.html


        // Waypoint / Feature & Linie zeichnen / hinzufügen
        //      http://openlayers.org/en/v3.1.1/examples/draw-features.html

        // Komplexes Beispiel mit importierten Daten, Mouspointer zeigt Info von Track
        //      http://openlayers.org/en/v3.1.1/examples/igc.html

        // Messen von Strecken (zeichnen und Länge ausgabe
        //      http://openlayers.org/en/v3.1.1/examples/measure.html

        // Mausposition auslesen und anzeigen
        //      http://openlayers.org/en/v3.1.1/examples/mouse-position.html

        // Position Popup (Bootstrap)
        //      http://openlayers.org/en/v3.1.1/examples/overlay.html

        // Näher Untersuchen - Schweizerkarte mit Layers!
        // http://openlayers.org/en/v3.1.1/examples/wms-custom-proj.html
        */

        window.app = {};
        var app = window.app;





        /**
         * @constructor
         * @extends {ol.interaction.Pointer}
         */
        app.Drag = function() {

            ol.interaction.Pointer.call(this, {
                handleDownEvent: app.Drag.prototype.handleDownEvent,
                handleDragEvent: app.Drag.prototype.handleDragEvent,
                handleMoveEvent: app.Drag.prototype.handleMoveEvent,
                handleUpEvent: app.Drag.prototype.handleUpEvent
            });

            /**
             * @type {ol.Pixel}
             * @private
             */
            this.coordinate_ = null;

            /**
             * @type {string|undefined}
             * @private
             */
            this.cursor_ = 'pointer';

            /**
             * @type {ol.Feature}
             * @private
             */
            this.feature_ = null;

            /**
             * @type {string|undefined}
             * @private
             */
            this.previousCursor_ = undefined;

        };
        ol.inherits(app.Drag, ol.interaction.Pointer);


        /**
         * @param {ol.MapBrowserEvent} evt Map browser event.
         * @return {boolean} `true` to start the drag sequence.
         */
        app.Drag.prototype.handleDownEvent = function(evt) {
            var map = evt.map;

            var feature = map.forEachFeatureAtPixel(evt.pixel,
                    function(feature, layer) {
                        return feature;
                    });

            if (feature) {
                this.coordinate_ = evt.coordinate;
                this.feature_ = feature;
            }

            return !!feature;
        };


        /**
         * @param {ol.MapBrowserEvent} evt Map browser event.
         */
        app.Drag.prototype.handleDragEvent = function(evt) {
            var map = evt.map;

            var feature = map.forEachFeatureAtPixel(evt.pixel,
                    function(feature, layer) {
                        return feature;
                    });

            var deltaX = evt.coordinate[0] - this.coordinate_[0];
            var deltaY = evt.coordinate[1] - this.coordinate_[1];

            var geometry = /** @type {ol.geom.SimpleGeometry} */
                    (this.feature_.getGeometry());
            geometry.translate(deltaX, deltaY);

            this.coordinate_[0] = evt.coordinate[0];
            this.coordinate_[1] = evt.coordinate[1];
        };


        /**
         * @param {ol.MapBrowserEvent} evt Event.
         */
        app.Drag.prototype.handleMoveEvent = function(evt) {
            if (this.cursor_) {
                var map = evt.map;
                var feature = map.forEachFeatureAtPixel(evt.pixel,
                        function(feature, layer) {
                            return feature;
                        });
                var element = evt.map.getTargetElement();
                if (feature) {
                    if (element.style.cursor != this.cursor_) {
                        this.previousCursor_ = element.style.cursor;
                        element.style.cursor = this.cursor_;
                    }
                } else if (this.previousCursor_ !== undefined) {
                    element.style.cursor = this.previousCursor_;
                    this.previousCursor_ = undefined;
                }
            }
        };


        /**
         * @param {ol.MapBrowserEvent} evt Map browser event.
         * @return {boolean} `false` to stop the drag sequence.
         */
        app.Drag.prototype.handleUpEvent = function(evt) {
            this.coordinate_ = null;
            this.feature_ = null;
            return false;
        };












        /**
         * @constructor
         * @extends {ol.control.Control}
         * @param {Object=} opt_options Control options.
         */
        app.RotateNorthControl = function(opt_options) {

            var options = opt_options || {};

            var anchor = document.createElement('a');
            anchor.href = '#rotate-north';
            anchor.innerHTML = '<span id="geoMapKoords"></span>';

            var this_ = this;
            var handleRotateNorth = function(e) {
                // prevent #rotate-north anchor from getting appended to the url
                e.preventDefault();
                this_.getMap().getView().setRotation(this_.getMap().getView().getRotation() + 90);
            };

            anchor.addEventListener('click', handleRotateNorth, false);
            anchor.addEventListener('touchstart', handleRotateNorth, false);

            var element = document.createElement('div');
            element.className = 'rotate-north ol-unselectable';
            element.appendChild(anchor);

            ol.control.Control.call(this, {
                element: element,
                target: options.target
            });
        };

        ol.inherits(app.RotateNorthControl, ol.control.Control);
        // ol.inherits(app.Drag, ol.interaction.Pointer);


        var layer = ga.layer.create('ch.swisstopo.pixelkarte-farbe');
        var map = new ga.Map({
            interactions: ol.interaction.defaults().extend([new app.Drag()]),
            controls: ol.control.defaults({
                attributionOptions: /** @type {olx.control.AttributionOptions} */ ({
                    collapsible: false
                })
            }).extend([
                new app.RotateNorthControl()
            ]),
            target: 'map',
            layers: [layer],
            view: new ol.View({
                resolution: 3,
                center: [679420,235646]
            })
        });

        var mousePositionControl = new ol.control.MousePosition({
            coordinateFormat: ol.coordinate.createStringXY(0),
            projection: 'EPSG:21781',
            className: 'custom-mouse-position',
            target: document.getElementById('geoMapKoords'),
            undefinedHTML: '&nbsp;'
        });

        map.addControl(mousePositionControl);
    </script>

    <div stlye="z-index:1;">
        <p>Bank: 678975 236021 Parkplatz: 678900 236121</p>
        <p>Bank: N 47° 16.0483 E 008° 29.3288 Parkplatz: N 47° 16.2483 E 008° 29.5233</p>
    </div>

</body>
</html>